---
title: "Profiles API"
---
{/*
SPDX-FileCopyrightText: 2022-2026 TII (SSRC) and the Ghaf contributors
SPDX-License-Identifier: CC-BY-SA-4.0
*/}

# Profiles API

The `lib.ghaf` namespace provides predefined configuration profiles and a factory function for creating custom profiles in the Ghaf framework.

## Overview

Profiles provide consistent sets of global configuration values. Instead of manually configuring each option, select a profile that matches your needs.

```nix
lib.ghaf = {
  profiles = {
    debug     # Development/debugging profile
    release   # Production release profile
    minimal   # Minimal configuration profile
  };
  mkGlobalConfig   # Create custom profile by extending a base
};
```

---

## Predefined Profiles

### debug

Development profile with extensive debugging capabilities.

```nix
lib.ghaf.profiles.debug = {
  debug = {
    enable = true;
    enableSsh = true;
    enableVnc = false;
  };
  release = false;
  development = {
    debug.tools.enable = true;
    ssh.daemon.enable = true;
  };
  givc.enable = true;
  givc.debug = true;
  logging.enable = true;
};
```

**Use when:**
- Development and testing
- Need SSH access to VMs
- Need debug tools installed
- Troubleshooting issues

**Example:**
```nix
ghaf.global-config = lib.ghaf.profiles.debug;
```

---

### release

Production profile with security hardening.

```nix
lib.ghaf.profiles.release = {
  debug = {
    enable = false;
    enableSsh = false;
    enableVnc = false;
  };
  release = true;
  development = {
    debug.tools.enable = false;
    ssh.daemon.enable = false;
  };
  givc.enable = true;
  givc.debug = false;
  logging.enable = true;
};
```

**Use when:**
- Production deployments
- Security-sensitive environments
- Final product images

**Example:**
```nix
ghaf.global-config = lib.ghaf.profiles.release;
```

---

### minimal

Stripped-down profile for resource-constrained environments.

```nix
lib.ghaf.profiles.minimal = {
  debug = {
    enable = false;
    enableSsh = false;
    enableVnc = false;
  };
  release = true;
  development = {
    debug.tools.enable = false;
    ssh.daemon.enable = false;
  };
  givc.enable = false;
  givc.debug = false;
  logging.enable = false;
};
```

**Use when:**
- Resource-constrained hardware
- Minimal footprint requirements
- Testing core functionality without extras

**Example:**
```nix
ghaf.global-config = lib.ghaf.profiles.minimal;
```

---

## Profile Comparison

| Setting | debug | release | minimal |
|---------|-------|---------|---------|
| `debug.enable` | ✅ | ❌ | ❌ |
| `debug.enableSsh` | ✅ | ❌ | ❌ |
| `release` | ❌ | ✅ | ✅ |
| `development.debug.tools.enable` | ✅ | ❌ | ❌ |
| `development.ssh.daemon.enable` | ✅ | ❌ | ❌ |
| `givc.enable` | ✅ | ✅ | ❌ |
| `givc.debug` | ✅ | ❌ | ❌ |
| `logging.enable` | ✅ | ✅ | ❌ |

---

## mkGlobalConfig

Factory function for creating custom profiles by extending a base profile.

**Signature:**

```nix
mkGlobalConfig :: AttrSet -> AttrSet
mkGlobalConfig overrides
```

**Parameters:**

| Name | Type | Description |
|------|------|-------------|
| `overrides` | AttrSet | Values to merge over the debug profile base |

**Returns:** Complete global configuration attrset.

**Example:**

```nix
# Start with debug profile, customize some settings
ghaf.global-config = lib.ghaf.mkGlobalConfig {
  # Override specific settings
  givc.debug = false;
  development.ssh.daemon.enable = false;

  # Add custom settings
  features.fprint.targetVms = [ "admin-vm" ];
};
```

---

## Usage Patterns

### Pattern 1: Direct Profile Selection

Simplest approach - select a predefined profile:

```nix
# For development
ghaf.global-config = lib.ghaf.profiles.debug;

# For production
ghaf.global-config = lib.ghaf.profiles.release;
```

### Pattern 2: Profile with Overrides

Use a profile as base, then customize:

```nix
ghaf.global-config = lib.ghaf.profiles.debug // {
  # Disable GIVC debugging
  givc.debug = false;

  # Custom logging config
  logging.listener.port = 9998;
};
```

### Pattern 3: mkGlobalConfig Factory

Use the factory for cleaner customization:

```nix
ghaf.global-config = lib.ghaf.mkGlobalConfig {
  # All debug profile defaults applied
  # Just specify overrides:
  features = {
    fprint.targetVms = [ "admin-vm" ];
    bluetooth.enable = false;
  };
};
```

### Pattern 4: Downstream Project Profile

Create a project-specific profile:

```nix
# In downstream project's lib/profiles.nix
{ lib }:
{
  fmoDebug = lib.ghaf.mkGlobalConfig {
    # FMO-specific debug settings
    features.yubikey.targetVms = [ "gui-vm" "gcs-vm" ];
    logging.listener.port = 10000;
  };

  fmoRelease = lib.ghaf.profiles.release // {
    # FMO production overrides
    features.yubikey.targetVms = [ "gui-vm" "gcs-vm" ];
  };
}
```

### Pattern 5: Conditional Profile Selection

Select profile based on variant:

```nix
# In target configuration
{ variant ? "debug", lib, ... }:
{
  ghaf.global-config =
    if variant == "release"
    then lib.ghaf.profiles.release
    else lib.ghaf.profiles.debug;
}
```

---

## Complete globalConfig Schema

For reference, here's the full schema of values in globalConfig:

```nix
{
  # Debug settings
  debug = {
    enable = bool;        # Master debug switch
    enableSsh = bool;     # SSH access to VMs
    enableVnc = bool;     # VNC access to GUI VM
  };

  # Release mode
  release = bool;

  # Development tools
  development = {
    debug.tools.enable = bool;
    ssh.daemon.enable = bool;
  };

  # GIVC inter-VM communication
  givc = {
    enable = bool;
    debug = bool;
  };

  # System logging
  logging = {
    enable = bool;
    listener = {
      address = str;      # Default: "192.168.101.2"
      port = int;         # Default: 9999
    };
  };

  # Platform settings
  platform.timeZone = str;  # Default: "UTC"

  # Feature assignments
  features = {
    fprint = {
      enable = bool;
      targetVms = [ str ];
    };
    yubikey = {
      enable = bool;
      targetVms = [ str ];
    };
    brightness = {
      enable = bool;
      targetVms = [ str ];
    };
    wifi = {
      enable = bool;
      targetVms = [ str ];
    };
    audio = {
      enable = bool;
      targetVms = [ str ];
    };
    bluetooth = {
      enable = bool;
      targetVms = [ str ];
    };
  };

  # Shared memory configuration
  shm = {
    wayland.enable = bool;
    audio.enable = bool;
    gpu.enable = bool;
    control.enable = bool;
  };

  # IDS VM settings
  idsvm.mitmproxy.enable = bool;

  # Hardware display config
  hardware.displays = [ displayDefinition ];
}
```

---

## Integration with Targets

Profiles are typically set in target configurations:

```nix
# targets/laptop/flake-module.nix
{
  laptop-configuration = { name, variant, ... }:
    inputs.self.lib.ghaf.builders.mkGhafConfiguration {
      inherit name;
      # Profile selected based on variant
      globalConfig =
        if variant == "release"
        then lib.ghaf.profiles.release
        else lib.ghaf.profiles.debug;
      # ... rest of configuration
    };
}
```

---

## See Also

- [Global Config Reference](/ghaf/dev/global-config) - Detailed option documentation
- [Configuration Propagation](/ghaf/dev/architecture/config-propagation) - How profiles flow to VMs
- [Extending Targets](/ghaf/dev/guides/extending-targets) - Using profiles in targets
