<html>
  <head>
    <style type="text/css">
      body {
        font-family: Serif;
        font-size: 12pt;
        background-color: #fff;
        color: #000;
      }
      code {
        font-family: Mono;
        font-size: 12pt;
      }
    </style>
  </head>
  <body>
    <p><!--
    Copyright 2022-2024 TII (SSRC) and the Ghaf contributors
    SPDX-License-Identifier: CC-BY-SA-4.0
--!></p>

<h1>How to Use a Linux Laptop or Computer as a Router for Ghaf.</h1>

<p>Because Ghafâ€™s Wifi is reserved by NetVM an additional network is needed for a debugging
setup. A Linux computer can be used to provide internet accces to Ghaf. The Linux computer,
for instance a laptop with a mainstream Linux distro can act as a router.</p>

<p><em>The role of the Linux computer is to forward its access to internet via a shared Ethernet
connection to Ghaf on Jetson.</em></p>

<hr />

<h3>Preparations</h3>

<ol>
<li><p>Make sure the Linux computer is <strong>fully connected</strong> to the internet and that an Ethernet
device <strong>is free</strong> to be configured. Typically the computer would have internet over its
Wifi device leaving the Ethernet device unused. These instructions do not describe how to
provide internet access to the router/laptop using Wifi.</p></li>
<li><p><strong>Connect</strong> the Linux computer using an Ethernet cable to Jetson in a peer-to-peer fashion.</p></li>
<li><p>The Ethernet device in Jetson is called eth0 but in Linux it probably has another name.
 Note that most Linux distributions use NetworkManager (providing for instance the nmcli
 tool) and Ghaf uses networkd (providing networkctl).</p>

<p> You can inspect the devices and IP adresses in a NetworkManager system using &lsquo;nmcli c s&rsquo;
 and &lsquo;ifconfig&rsquo;. In a networkd system like Ghaf you can use &lsquo;ip address show eth0&rsquo; and &lsquo;ifconfig&rsquo;
 ( the &lsquo;ip&rsquo; command is usually also available on NetworkManager systems)</p></li>
</ol>


<p><code>
            ip address show
</code></p>

<h3><strong>On the Linux computer</strong></h3>

<ol>
<li><p>Find out the name of the Ethernet device using nmcli. Typically
its called &lsquo;Wired Connection 1&rsquo; or something similar. Its type will be declared as Ethernet.</p>

<p>Take note of the connection name and the  Ethernet device name.</p></li>
</ol>


<p><code>
            connection show
</code>
1. Clone the Ethernet device with:</p>

<p><code>
            sudo nmcli connection clone Wired\ Connection\ 1 Shared\ Connection
</code>
1.  Set ipv4 mode to shared and disable ipv6</p>

<p><code>
            sudo nmcli connection modify Shared\ Connection ipv4.method shared
            sudo nmcli connection modify Shared\ Connection ipv6.method disabled
</code>
1.  Make sure the new configuration is active</p>

<p><code>
            sudo nmcli connection down Wired\ Connection\ 1
            sudo nmcli connection down Shared\ Connection
            sudo nmcli connection reload Shared\ Connection
            sudo nmcli connection up Shared\ Connection
</code>
1.  Note the IP address and Ethernet device name of Shared Connection using.</p>

<p><code>        nmcli connection show
            if config &lt;ethernet device name
</code>
    The IP could be something like &lsquo;10.42.0.1&rsquo;. Note the namespace or the netmask.</p>

<h3><strong>On Ghaf</strong></h3>

<ol>
<li>Log in to Ghaf using the serial console and for instance picocom</li>
</ol>


<p><code>
            sudo picocom -b 115200 /dev/ttyACM0
</code>
1.  Set the IP address of Ethernet on Ghaf within the namespace of the Shared Connection.
    Do not use exactly the same IP address as the router.</p>

<p><code>
            sudo ip address add 10.42.0.2/24 dev eth0
            sudo ifconfig eth0 down
            sudo ifconfig eth0 up
</code>
1. You can verify the result from Ghaf with</p>

<p>```
            ip address show eth0
            ifconfig
            ping 10.42.0.1
            host elisa.fi
            ping -c2 elisa.fi</p>

<h2>```</h2>
  </body>
</html>
