From 92b81c72be96bd0dc7667352a4c4a543e349662f Mon Sep 17 00:00:00 2001
From: Everton de Matos <everton.dematos@tii.ae>
Date: Tue, 20 Jan 2026 12:57:32 +0400
Subject: [PATCH] cosmic-greeter: ignore empty password submissions

Signed-off-by: Everton de Matos <everton.dematos@tii.ae>
---
 src/greeter.rs |  7 +++++++
 src/locker.rs  | 11 +++++++++++
 2 files changed, 18 insertions(+)

diff --git a/src/greeter.rs b/src/greeter.rs
index d917e79..3125177 100644
--- a/src/greeter.rs
+++ b/src/greeter.rs
@@ -1475,6 +1475,13 @@ impl cosmic::Application for App {
             }
             Message::Auth(response) => {
                 self.common.error_opt = None;
+
+                if matches!(response.as_deref(), None | Some("")) {
+                    self.authenticating = false;
+                    self.common.error_opt = Some(fl!("auth-error-credentials"));
+                    return Task::none();
+                }
+
                 self.authenticating = true;
                 self.send_request(Request::PostAuthMessageResponse { response });
 
diff --git a/src/locker.rs b/src/locker.rs
index 49b13fe..651fd49 100644
--- a/src/locker.rs
+++ b/src/locker.rs
@@ -1041,6 +1041,17 @@ impl cosmic::Application for App {
             }
             Message::Submit(value) => {
                 self.common.error_opt = None;
+
+                if value.is_empty() {
+                    self.authenticating = false;
+                    if let Some(handle) = self.spinner_handle.take() {
+                        handle.abort();
+                    }
+                    self.spinner_rotation = 0.0;
+                    self.common.error_opt = Some(fl!("auth-error-credentials"));
+                    return Task::none();
+                }
+
                 self.authenticating = true;
                 match self.value_tx_opt.take() {
                     Some(value_tx) => {
-- 
2.52.0

