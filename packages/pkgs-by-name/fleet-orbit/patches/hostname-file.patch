# SPDX-FileCopyrightText: 2022-2026 TII (SSRC) and the Ghaf contributors
# SPDX-License-Identifier: Apache-2.0

diff --git a/orbit/cmd/orbit/orbit.go b/orbit/cmd/orbit/orbit.go
--- a/orbit/cmd/orbit/orbit.go
+++ b/orbit/cmd/orbit/orbit.go
@@ -226,7 +226,7 @@
 		},
 		&cli.StringFlag{
 			Name:    "host-identifier",
-			Usage:   "Sets the host identifier that orbit and osquery will use when enrolling to Fleet. Options: 'uuid' and 'instance' (requires Fleet >= v4.42.0)",
+			Usage:   "Sets the host identifier that orbit and osquery will use when enrolling to Fleet. Options: 'uuid', 'instance' (requires Fleet >= v4.42.0), 'hostname', and 'specified'",
 			EnvVars: []string{"ORBIT_HOST_IDENTIFIER"},
 			Value:   "uuid",
 		},
@@ -431,8 +431,8 @@
 			}
 		}
 
-		if hostIdentifier := c.String("host-identifier"); hostIdentifier != "uuid" && hostIdentifier != "instance" {
-			return fmt.Errorf("--host-identifier=%s is not supported, currently supported values are 'uuid' and 'instance'", hostIdentifier)
+		if hostIdentifier := c.String("host-identifier"); hostIdentifier != "uuid" && hostIdentifier != "instance" && hostIdentifier != "hostname" && hostIdentifier != "specified" {
+			return fmt.Errorf("--host-identifier=%s is not supported, currently supported values are 'uuid', 'instance', 'hostname', and 'specified'", hostIdentifier)
 		}
 
 		if email := c.String("end-user-email"); email != "" && email != unusedFlagKeyword && !fleet.IsLooseEmail(email) {
@@ -767,10 +767,38 @@
 			return fmt.Errorf("get UUID: %w", err)
 		}
 		log.Debug().Str("info", fmt.Sprint(osqueryHostInfo)).Msg("retrieved host info from osquery")
+		hostname := osqueryHostInfo.Hostname
+		hostnameFile := c.String("hostname-file")
+		if hostnameFile == "" {
+			hostnameFile = os.Getenv("ORBIT_HOSTNAME_FILE")
+		}
+		if hostnameFile == "" {
+			hostnameFile = os.Getenv("OSQUERY_HOSTNAME_FILE")
+		}
+		if hostnameFile != "" {
+			if data, err := os.ReadFile(hostnameFile); err != nil {
+				log.Warn().Err(err).Str("path", hostnameFile).Msg("failed to read hostname file, using system hostname")
+			} else if fileHostname := strings.TrimSpace(string(data)); fileHostname != "" {
+				hostname = fileHostname
+				log.Info().Str("hostname", hostname).Str("path", hostnameFile).Msg("using hostname from file")
+			} else {
+				log.Warn().Str("path", hostnameFile).Msg("hostname file was empty, using system hostname")
+			}
+		}
+		if uuidFile := os.Getenv("OSQUERY_UUID_FILE"); uuidFile != "" {
+			if data, err := os.ReadFile(uuidFile); err != nil {
+				log.Warn().Err(err).Str("path", uuidFile).Msg("failed to read uuid file, using system uuid")
+			} else if fileUUID := strings.TrimSpace(string(data)); fileUUID != "" {
+				osqueryHostInfo.HardwareUUID = fileUUID
+				log.Info().Str("uuid", fileUUID).Str("path", uuidFile).Msg("using uuid from file")
+			} else {
+				log.Warn().Str("path", uuidFile).Msg("uuid file was empty, using system uuid")
+			}
+		}
 		orbitHostInfo := fleet.OrbitHostInfo{
 			HardwareSerial: osqueryHostInfo.HardwareSerial,
 			HardwareUUID:   osqueryHostInfo.HardwareUUID,
-			Hostname:       osqueryHostInfo.Hostname,
+			Hostname:       hostname,
 			Platform:       osqueryHostInfo.Platform,
 			ComputerName:   osqueryHostInfo.ComputerName,
 			HardwareModel:  osqueryHostInfo.HardwareModel,
@@ -852,6 +873,17 @@
 			)
 		}
 
+		if hostnameFile := c.String("hostname-file"); hostnameFile != "" {
+			options = append(options, osquery.WithEnv([]string{"OSQUERY_HOSTNAME_FILE=" + hostnameFile}))
+		} else if envHostnameFile := os.Getenv("ORBIT_HOSTNAME_FILE"); envHostnameFile != "" {
+			options = append(options, osquery.WithEnv([]string{"OSQUERY_HOSTNAME_FILE=" + envHostnameFile}))
+		} else if envHostnameFile := os.Getenv("OSQUERY_HOSTNAME_FILE"); envHostnameFile != "" {
+			options = append(options, osquery.WithEnv([]string{"OSQUERY_HOSTNAME_FILE=" + envHostnameFile}))
+		}
+		if uuidFile, ok := os.LookupEnv("OSQUERY_UUID_FILE"); ok && uuidFile != "" {
+			options = append(options, osquery.WithEnv([]string{"OSQUERY_UUID_FILE=" + uuidFile}))
+		}
+
 		if runtime.GOOS == "windows" {
 			if systemDrive, ok := os.LookupEnv("SystemDrive"); ok {
 				options = append(options, osquery.WithEnv([]string{fmt.Sprintf("SystemDrive=%s", systemDrive)}))
